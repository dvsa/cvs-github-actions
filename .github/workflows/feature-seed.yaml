name: 🌱 Seed Feature Database
run-name: "🌱 ${{github.actor}} is seeding from ${{ inputs.branch }}"
on:
  workflow_dispatch:
    inputs:
      branch:
        description: The feature environment to seed (cvs-1234)
        type: string
        required: true
      dry_run:
        description: Dry run the destroy
        type: boolean
        required: false
        default: true

permissions:
  id-token: write
  contents: write

jobs:
  process_inputs:
    runs-on: ubuntu-latest
    outputs: 
      branch: ${{ steps.branch.outputs.value }}
    steps:
      - name: ↕️ Get Branch Name
        id: branch
        run: |
          BRANCH=$(echo ${{ inputs.branch }} | tr '[a-z]' '[A-Z]')
          echo "value=feature/${BRANCH}" >> $GITHUB_OUTPUT
          echo "feature/${BRANCH}" >> $GITHUB_STEP_SUMMARY

  feature_seed:
    name: 🌱 Seed Environment
    runs-on: ubuntu-latest
    needs: process_inputs
    if: ${{ !contains('["develop", "integration", "preprod", "prod"]', inputs.branch) }}
    strategy:
      matrix:
        environment: ${{ fromJson('feature-seed.json') }}
    steps:
      - name: test
        run: |
          echo ${{ matrix.environment }}
  
