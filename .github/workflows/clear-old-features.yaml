# for k in $(git branch -r | sed /\*/d); do 
#   if [ -z "$(git log -1 --since='12 weeks ago' -s $k)" ]; then
#     if [[ $k = *origin/feature* ]]; then
#         echo $k
#     fi
#     # git branch -D $k
#   fi
# done


name: Clear Stale Branches
run-name: "Clear Stale Branches ${{ github.run_id }}"
on:
  workflow_call:

permissions:
  id-token: write
  contents: write        

jobs:
  find-old-branches:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¨ Get Codebase
        uses: actions/checkout@v3

      - name: ðŸ‘´ Get Old Branches
        run: |
          git fetch
          echo "## Old GitHub Branches" >> $GITHUB_STEP_SUMMARY
          for branch in $(git branch -a | sed 's/^\s*//'); do 
            if [ -z "$(git log -1 --since='3 months ago' -s $branch)" ]; then
              if [[ $branch = *origin/feature* && $branch != *origin/feature* ]]; then
                echo $branch >> $GITHUB_STEP_SUMMARY
              fi
            fi
          done