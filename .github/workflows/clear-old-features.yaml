# for k in $(git branch -r | sed /\*/d); do 
#   if [ -z "$(git log -1 --since='12 weeks ago' -s $k)" ]; then
#     if [[ $k = *origin/feature* ]]; then
#         echo $k
#     fi
#     # git branch -D $k
#   fi
# done


name: Clear Stale Branches
run-name: "Clear Stale Branches ${{ github.run_id }}"
on:
  workflow_call:

permissions:
  id-token: write
  contents: write        

jobs:
  find-old-branches:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¨ Get Codebase
        uses: actions/checkout@v3

      - name: ðŸ‘´ Get Old Branches
        run: |
          git fetch
          for branch in $(git branch -a | sed 's/^\s*//' | sed 's/^remotes\///' | grep -v 'master$\|develop$'); do 
            if [ -z "$(git log -1 --since='1 month ago' -s $branch)" ]; then
              if [[ $branch = *origin/feature* ]]; then
                echo $branch
              fi
            fi
          done