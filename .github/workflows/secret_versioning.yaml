name: Update Version

on:
  push:
    branches:
      - feature/CB2-10972

jobs:
  update_version:
    permissions:
        id-token: write
        contents: write
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Credentials
      uses: aws-actions/configure-aws-credentials@v3
      with:
        role-to-assume: ${{ secrets.CVS_MGMT_AWS_ROLE }}
        aws-region: ${{ secrets.DVSA_AWS_REGION }}
        role-session-name: 'GHA_Versioning'

    - name : Get secret
      uses: aws-actions/aws-secretsmanager-get-secrets@v1
      with:
        secret-ids: develop/version
        parse-json-secrets: true

    - name: Upload Secrets
      id: get-secrets
      run: |
        VERSION="v1.$(date +'%Y%m%d%H%M%S')"
        secrets_json=$(aws secretsmanager put-secret-value --secret-id 'develop/version' --version-stage AWSCURRENT --region ${{ secrets.DVSA_AWS_REGION}} --secret-string "$VERSION" )
        echo "secrets_json=$secrets_json" >> $GITHUB_ENV



    
        

